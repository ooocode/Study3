@page "{Id?}"
@model Study.WebApp.Pages.Forum.UpdateArticalModel
@{
    ViewData["Title"] = "修改";
}

<div class="row">
    <div class="col-lg-10 col-xl-8 ">
        <div style="margin:0 auto 30px;">
            <form asp-page-handler="UpdateArtical" asp-route-Id="@Model.Id" method="post" onsubmit="return onFormSubmit()">
                <div asp-validation-summary="ModelOnly" class="text-danger"></div>

                <input type="hidden" asp-for="UpdateArticalDto.ArticalId" />

                <div class="form-group">
                    <label class="col-form-label">标题</label>
                    <input type="text" class="form-control" asp-for="UpdateArticalDto.Title" />
                    <span asp-validation-for="UpdateArticalDto.Title" class="text-danger"></span>
                </div>

                <div class="form-group">
                    <label class="col-form-label">分组</label>
                    <select asp-for="UpdateArticalDto.ClassificationId" class="custom-select">
                        @foreach (var item in (await ArticalService.GetArticalClassificationsAsync()))
                        {
                            <option value="@item.Id">@item.Name</option>
                        }
                    </select>
                    <span asp-validation-for="UpdateArticalDto.ClassificationId" class="text-danger"></span>
                </div>

                <div class="form-group">
                    <label class="col-form-label">正文内容</label>
                    <textarea class="summernote" asp-for="UpdateArticalDto.Content"></textarea>
                    <span asp-validation-for="UpdateArticalDto.Content" class="text-danger"></span>
                </div>

                <input type="submit" value="提交" class="btn btn-primary" />
            </form>
        </div>
    </div>
</div>



@section Scripts{
    <script>
        $(document).ready(function () {
            var repositionToolbar = function () {
                // 根据 summernote className 找到他的 toolbar
                const $editor = $('.summernote').siblings('.note-editor');
                const $toolbar = $editor.find('.note-toolbar');



                // 得到浏览器当前滚动条 top 位置(绝对)
                const windowTop = $(window).scrollTop();


                // 编辑器的 top 位置(绝对坐标)
                const editorTop = $editor.offset().top;


                console.log('滚动条顶部' + windowTop);
                console.log('编辑器顶部' + editorTop);

                if (/*editorTop - windowTop > 100 ||*/ windowTop > editorTop) {
                    $toolbar.css('position', 'fixed');
                    $toolbar.css('width', `${$editor.width()}px`);
                    $toolbar.css('top', `50px`);
                    //$toolbar.css('z-index', '9999966');
                } else {
                    $toolbar.css('position', 'static');
                    $editor.css('padding-top', '0px');
                }
            };

            $(window).scroll(function () {
                console.log('滚动');
                repositionToolbar();
            });



            $(window).resize(function () {
                this.console.log('大小改动');
                repositionToolbar();
            });


            $('.summernote').summernote({
                disableDragAndDrop: true,
                lang: 'zh-CN', // default: 'en-US'
                callbacks: {
                    onImageUpload: function (files) {
                        //上传图片到服务器
                        var formData = new FormData();
                        formData.append('file', files[0]);
                        $.ajax({
                            url: '/api/file',//后台文件上传接口
                            type: 'POST',
                            data: formData,
                            processData: false,
                            contentType: false,
                            success: function (path) {
                                console.log(path.link);
                                $('.summernote').summernote('insertImage', path.link);
                            }, error: function () {
                                alert("上传失败");
                            }
                        });
                    }
                }
            });
        });
        function onFormSubmit() {
            if ($('.summernote').summernote('isEmpty')) {
                swal("错误", "正文不能为空!", "error")
                return false
            }
            return true
        }
    </script>
}