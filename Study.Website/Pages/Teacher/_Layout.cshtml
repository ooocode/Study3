<!DOCTYPE html>
<html style="overflow-x:hidden">
<head>
    <meta name="baidu-site-verification" content="drlbIWRgI6" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>@ViewData["Title"] - 学习坊</title>
    <meta name="keywords" content="学习坊,编程技术,博客,数据库,数据结构与算法,AspNetCore" />
    <meta name="description" content="学习坊是专注于技术的博客论坛，每天更新系列技术文章" />
    <partial name="_CssPartial" />

    <link rel="stylesheet" href="~/lib/element-ui/theme-chalk/index.css" />
    <link rel="stylesheet" href="~/admin-lte/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css" />

    @RenderSection("Head", required: false)
</head>
<body class="hold-transition sidebar-mini layout-navbar-fixed sidebar-light-blue">
    @*class=" hold-transition skin-black-light sidebar-mini"*@
    <mini-profiler />
    <!--导航栏-->

    @{
        var curUserId = Model.CurUserId as string;
    }


    <div class="wrapper">
        <!-- Navbar -->
        <nav class="main-header navbar navbar-expand navbar-white navbar-light">
            <!-- Left navbar links -->
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" data-widget="pushmenu" href="#"><i class="fas fa-bars"></i></a>
                </li>
                <li class="nav-item d-none d-sm-inline-block">
                    <a href="/Teacher/Index" class="nav-link">主页</a>
                </li>
                <li class="nav-item d-none d-sm-inline-block">
                    <a href="/" class="nav-link">学习坊论坛</a>
                </li>
            </ul>

            <!-- SEARCH FORM -->
            @*<form class="form-inline ml-3">
                <div class="input-group input-group-sm">
                    <input class="form-control form-control-navbar" type="search" placeholder="Search" aria-label="Search">
                    <div class="input-group-append">
                        <button class="btn btn-navbar" type="submit">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
            </form>*@

            <!-- Right navbar links -->
            <ul class="navbar-nav ml-auto">
                <li class="nav-item mr-5">
                    @User.Identity.Name
                    <a asp-action="Logout" asp-controller="Account" class="btn btn-link">注销</a>
                </li>
                <!-- Messages Dropdown Menu -->
                @*<li class="nav-item dropdown">
                    <a class="nav-link" data-toggle="dropdown" href="#">
                        <i class="far fa-comments"></i>
                        <span class="badge badge-danger navbar-badge">3</span>
                    </a>
                    <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right">
                        <a href="#" class="dropdown-item">
          
                            <div class="media">
                                <img src="../../dist/img/user1-128x128.jpg" alt="User Avatar" class="img-size-50 mr-3 img-circle">
                                <div class="media-body">
                                    <h3 class="dropdown-item-title">
                                        Brad Diesel
                                        <span class="float-right text-sm text-danger"><i class="fas fa-star"></i></span>
                                    </h3>
                                    <p class="text-sm">Call me whenever you can...</p>
                                    <p class="text-sm text-muted"><i class="far fa-clock mr-1"></i> 4 Hours Ago</p>
                                </div>
                            </div>
                    
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item">
                  
                            <div class="media">
                                <img src="../../dist/img/user8-128x128.jpg" alt="User Avatar" class="img-size-50 img-circle mr-3">
                                <div class="media-body">
                                    <h3 class="dropdown-item-title">
                                        John Pierce
                                        <span class="float-right text-sm text-muted"><i class="fas fa-star"></i></span>
                                    </h3>
                                    <p class="text-sm">I got your message bro</p>
                                    <p class="text-sm text-muted"><i class="far fa-clock mr-1"></i> 4 Hours Ago</p>
                                </div>
                            </div>
                    
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item">
                    
                            <div class="media">
                                <img src="../../dist/img/user3-128x128.jpg" alt="User Avatar" class="img-size-50 img-circle mr-3">
                                <div class="media-body">
                                    <h3 class="dropdown-item-title">
                                        Nora Silvester
                                        <span class="float-right text-sm text-warning"><i class="fas fa-star"></i></span>
                                    </h3>
                                    <p class="text-sm">The subject goes here</p>
                                    <p class="text-sm text-muted"><i class="far fa-clock mr-1"></i> 4 Hours Ago</p>
                                </div>
                            </div>
                      
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item dropdown-footer">See All Messages</a>
                    </div>
                </li>*@
                <!-- Notifications Dropdown Menu -->
                @*<li class="nav-item dropdown">
                    <a class="nav-link" data-toggle="dropdown" href="#">
                        <i class="far fa-bell"></i>
                        <span class="badge badge-warning navbar-badge">15</span>
                    </a>
                    <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right">
                        <span class="dropdown-item dropdown-header">15 Notifications</span>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item">
                            <i class="fas fa-envelope mr-2"></i> 4 new messages
                            <span class="float-right text-muted text-sm">3 mins</span>
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item">
                            <i class="fas fa-users mr-2"></i> 8 friend requests
                            <span class="float-right text-muted text-sm">12 hours</span>
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item">
                            <i class="fas fa-file mr-2"></i> 3 new reports
                            <span class="float-right text-muted text-sm">2 days</span>
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item dropdown-footer">See All Notifications</a>
                    </div>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-widget="control-sidebar" data-slide="true" href="#">
                        <i class="fas fa-th-large"></i>
                    </a>
                </li>*@
            </ul>
        </nav>

        <!-- /.navbar 左边栏目 -->
        <!-- Main Sidebar Container -->
        <aside class="main-sidebar sidebar-light-primary elevation-4">
            <!-- Brand Logo -->
            <a href="/Teacher/Index" class="brand-link text-center">
                @*<img src="../../dist/img/AdminLTELogo.png" alt="AdminLTE Logo"
                    class="brand-image img-circle elevation-3" style="opacity: .8">*@
                <span class="brand-text font-weight-light">学习坊教师后台</span>
            </a>

            <!-- Sidebar -->
            <div class="sidebar">
                <!-- Sidebar user (optional) -->
                @*<div class="user-panel mt-3 pb-3 mb-3 d-flex">
                    <div class="image">
                        <img src="../../dist/img/user2-160x160.jpg" class="img-circle elevation-2" alt="User Image">
                    </div>
                    <div class="info text-center">
                        <a href="#" class="d-block">@(User?.Identity?.Name)</a>
                    </div>
                </div>*@

                <!-- Sidebar Menu -->
                <nav class="mt-2">
                    <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
                        @*<li asp-authorize asp-roles="@ConstStrings.Role_Admin" class="nav-item">
                            <a href="https://zwovo.xyz:9999" target="_blank" class="nav-link">
                                <i class="nav-icon fas fa-th"></i>
                                <p>
                                    管理员功能
                                </p>
                            </a>
                        </li>*@

                        <li class="nav-item" asp-authorize asp-policy="@Permissons.Permisson.Teacher_Helpers">
                            <a href="/Teacher/TeacherFriend" class="nav-link">
                                @{
                                    int userFriendsCount = await UserService.GetCurUserFriendsCountAsync();
                                }
                                <i class="nav-icon fas fa-th"></i>
                                <p>
                                    我的助教
                                    <span class="right badge badge-info">@userFriendsCount</span>
                                </p>
                            </a>
                        </li>

                        <li class="nav-item">
                            @{
                                var courses = await CourseService.GetCourses()
                                    .Where(e => e.UserId == curUserId).ToListAsync();
                            }
                            <a href="/Teacher/Course/CourseList" class="nav-link">
                                <i class="nav-icon fas fa-th"></i>
                                <p>
                                    我的课程
                                    <span class="right badge badge-info">@courses.Count</span>
                                </p>
                            </a>
                        </li>


                        <li class="nav-item" asp-authorize asp-policy="@Permissons.Permisson.Teacher_Classes_CRUD">
                            <a href="/Teacher/Classes/SchoolClasses" class="nav-link">
                                <i class="nav-icon fas fa-th"></i>
                                <p>
                                    全校班级
                                </p>
                            </a>
                        </li>


                        <li class="nav-item">
                            @{
                                var classCount = await UserService.GetCurTeacherClassCountAsync();
                            }
                            <a href="/Teacher/Classes/List" class="nav-link">
                                <i class="nav-icon fas fa-th"></i>
                                <p>
                                    我的班级
                                    <span class="right badge badge-info">@classCount</span>
                                </p>
                            </a>
                        </li>


                        <li class="nav-header">
                            <hr />
                            课程作业管理
                        </li>

                        <li class="nav-item" asp-authorize asp-policy="@Permissons.Permisson.Teacher_Tasks_Create">
                            <a href="/Teacher/Tasks/AddTask" class="nav-link">
                                <i class="nav-icon far fa-plus-square"></i>
                                <p>
                                    发布作业
                                </p>
                            </a>
                            <hr />
                        </li>

                        @{ Dictionary<string, bool> haveModifyTask = new Dictionary<string, bool>(); }
                        @foreach (CourseDto course in courses)
                        {
                            //课程下面的作业
                            var courseTasks = await TaskService.GetTeacherTasks()
                                .Where(e => e.CourseId == course.Id && e.TeacherId == curUserId).ToListAsync();


                            <li class="nav-item has-treeview">
                                <a href="#" class="nav-link">
                                    @*<i class="nav-icon fas fa-chart-pie"></i>*@
                                    <p>
                                        @course.Name  @*课程名称*@

                                        <span class="right badge badge-danger mr-5" id="@course.Id"></span>

                                        @if (courseTasks.Count > 0)
                                        {
                                            <i class="right fas fa-angle-left"></i>
                                            <span class="right badge badge-success">@courseTasks.Count</span>
                                        }
                                    </p>
                                </a>
                                <ul class="nav nav-treeview">

                                    @foreach (var courseTask in courseTasks)
                                    {
                                        //需要批改的作业数
                                        var needMarkCount = await TaskService.GetStudentTasks()
                                         .CountAsync(e => e.TaskId == courseTask.Id && e.IsAlreadyAnswered && !e.IsTeacherModified);

                                        <li class="nav-item">
                                            <a href="/Teacher/Tasks/TaskDetail/@courseTask.Id" class="nav-link">
                                                <i class="far fa-circle nav-icon"></i>
                                                <p>
                                                    @courseTask.TaskName
                                                    @if (needMarkCount > 0)
                                                    {
                                                        haveModifyTask.TryAdd(course.Id, true);
                                                        <span class="right badge badge-danger">@needMarkCount 待批改</span>
                                                    }

                                                </p>
                                            </a>
                                        </li>
                                    }
                                </ul>
                            </li>
                        }

                    </ul>
                </nav>
                <!-- /.sidebar-menu -->
            </div>
            <!-- /.sidebar -->
        </aside>

        <!-- Content Wrapper. Contains page content -->
        <div class="content-wrapper">
            <!-- Content Header (Page header) -->
            @*<section class="content-header">
                    <div class="container-fluid">
                        <div class="row mb-2">
                            <div class="col-sm-6">
                                <h1>Fixed Navbar Layout</h1>
                            </div>
                            <div class="col-sm-6">
                                <ol class="breadcrumb float-sm-right">
                                    <li class="breadcrumb-item"><a href="#">Home</a></li>
                                    <li class="breadcrumb-item"><a href="#">Layout</a></li>
                                    <li class="breadcrumb-item active">Fixed Navbar Layout</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                </section>*@

            <!-- Main content -->
            <section class="content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-12 mt-2">
                            @RenderBody()

                        </div>
                    </div>
                </div>
            </section>
            <!-- /.content -->
        </div>
        <!-- /.content-wrapper -->

        @*<footer class="main-footer">
            <div class="float-right d-none d-sm-block">
                <b>Version</b> 3.0.3-pre
            </div>
            <strong>Copyright &copy; 2014-2019 <a href="http://adminlte.io">AdminLTE.io</a>.</strong> All rights
            reserved.
        </footer>*@

        <!-- Control Sidebar -->
        <aside class="control-sidebar control-sidebar-dark">
            <!-- Control sidebar content goes here -->
        </aside>
        <!-- /.control-sidebar -->
    </div>


    <partial name="_Script" />
    <script src="~/vue.js"></script>
    <script src="~/vue-router.js"></script>

    <script src="~/lib/element-ui/index.js"></script>

    <script src="~/admin-lte/plugins/datatables/jquery.dataTables.min.js"></script>
    <script src="~/admin-lte/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js"></script>

    <script>
        function decode(str) {
            // 一般可以先转换为标准 unicode 格式（有需要就添加：当返回的数据呈现太多\\\u 之类的时）
            str = unescape(str.replace(/\\u/g, "%u"));
            // 再对实体符进行转义
            // 有 x 则表示是16进制，$1 就是匹配是否有 x，$2 就是匹配出的第二个括号捕获到的内容，将 $2 以对应进制表示转换
            str = str.replace(/&#(x)?(\w+);/g, function ($, $1, $2) {
                return String.fromCharCode(parseInt($2, $1 ? 16 : 10));
            });

            return str;
        }
    </script>
    @{
        foreach (var item in haveModifyTask)
        {
            <script>
                document.getElementById("@item.Key").innerText = "New"
            </script>
        }
    }

    @RenderSection("Scripts", required: false)
</body>
</html>
